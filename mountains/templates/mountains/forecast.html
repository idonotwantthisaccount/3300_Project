<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{{ mymountain.name }} Forecast</title>
    {% load static %}
    <style>

        body {
            font-family: Arial, sans-serif;
            {% if background_image_url %}
                background-image: url("{{ background_image_url }}");
            {% else %}
                background-image: url("{% static 'default_background.jpg' %}"); /* Fallback image */
            {% endif %}
        background-size: cover; /* Ensures the background image covers the entire screen */
        background-repeat: no-repeat;
        background-position: center; /* Centers the background image */
        padding: 20px;
        display: flex;
        justify-content: center; /* Center content horizontally */
        align-items: center; /* Center content vertically */
        height: 100vh; /* Full viewport height */
        }


        .forecast-container {
            max-width: 600px; /* Adjust as needed */
            background-color: #fff; /* White background */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1); /* Subtle shadow effect */
            text-align: center; /* Center align content within container */
            margin: 20px; /* Spacing for each container for forecast */
        }

        .containter-list {
            list-style-type: none; /* Removes bullet points that appear with the buttons */
            display: flex; /* Allows for the buttons to lay in multiple columns instead of just one column */
            flex-wrap: wrap; /* Allows for the buttons to lay in multiple rows instead of just one row */
            justify-content: center; /* Ensures that the columns of buttons are centered to the container */
        }

        }

        h1 {
            color: #007bff; /* Blue color for the heading */
            margin-top: 0; /* Remove default margin for h1 */
        }


        p {
            margin-bottom: 10px; /* Space between paragraphs */
        }

        .back-link {
            margin-top: 20px; /* Space between content and back link */
        }

            .back-link a {
                color: #007bff; /* Blue color for the link */
                text-decoration: none; /* Remove underline */
            }

                .back-link a:hover {
                    text-decoration: underline; /* Underline on hover */
                }

        .url-button {
            display: block;
            width: 200px; /* Set a fixed width for buttons */
            padding: 12px; /* Adds padding from the text to the edge of the button */
            font-size: 16px; /* Button font size */
            color: #fff; /* Makes text white */
            background-color: #007bff; /* Create the light blue button background color */
            border-radius: 10px; /* Rounds the corners of the buttons */
            text-decoration: none; /* Removes the underline below button text */
            cursor: pointer; /* Changes the cursor to a pointer to help signify the button is interactable */
            transition: background-color 0.3s ease; /* Changes the button color that your cursor is hovering over */
            text-align: center; /* Center aligns the text within the button */
            margin: 0 auto;
        }

            .url-button:hover {
                background-color: #0056b3;
            }
    </style>
</head>
<body>
    <ul class="container-list">
    <div class="forecast-container">
        <h1>{{ mymountain.name }} Forecast<br> 
        Current:</h1>
        <label for="unit-system">Select Unit System: </label>
        <select id="unit-system" onchange="updateUnits()">
            <option value="imperial">Imperial</option>
            <option value="metric">Metric</option>
        </select>

        <p id="temperature"><strong>Current Temperature:</strong> {{ Temp }} F</p>
        <p id="base"><strong>Current Base:</strong> {{ Base }}</p>
        <p><strong>Current UV Index:</strong> {{ UV }}</p>
        <p id="visibility"><strong>Current Visibility:</strong> {{ Visibility }} meters</p>
        <p id="precipitation"><strong>Current Precipitation:</strong> {{ Precipitation }} in</p>

    </div>


    <script>
    // Function to convert meters to miles
    function metersToMiles(meters) {
        return (meters * 0.000621371).toFixed(2); // Convert meters to miles and round to 2 decimal places
        }

    // Function to convert meters to kilometers
    function metersToKm(meters) {
        return (meters / 1000).toFixed(2); // Convert meters to kilometers and round to 2 decimal places
    }

    // Function to convert meters to feet
    function metersToFeet(meters) {
        return (meters * 3.2808399).toFixed(2); // Convert meters to feet and round to 2 decimal places
    }

    // Function to convert Fahrenheit to Celsius
    function fahrenheitToCelsius(degreesF) {
        return (((degreesF - 32) * 5) / 9).toFixed(2);
    }

    // Function to convert feet to meters
    function feetToMeters(feet) {
        return (feet * 0.3048).toFixed(2); // Convert feet to meters and round to 2 decimal places
    }


    // Function to convert inches to millimeters
    function inchesToMillimeters(inches) {
        return (inches * 25.4).toFixed(2); // Convert inches to millimeters and round to 2 decimal places
    }

    // Function to format numbers with commas
    function formatNumberWithCommas(number) {
        return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // Update visibility, temperature, base, and precipitation based on selected unit system
    function updateUnits() {
        const unitSystem = document.getElementById('unit-system').value;
        const visibilityElement = document.getElementById('visibility');
        const tempElement = document.getElementById('temperature');
        const baseElement = document.getElementById('base');
        const precipitationElement = document.getElementById('precipitation');
        const temp24Element = document.getElementById('temp24');
        const precip24Element = document.getElementById('precip24');          
        
        // Update visibility
        const visibilityValue = parseFloat('{{ Visibility }}');
        if (unitSystem === 'imperial') {
            const visibilityInMiles = metersToMiles(visibilityValue); // Convert visibility from meters to miles
            visibilityElement.innerHTML = `<strong>Current Visibility:</strong> ${visibilityInMiles} miles`;
        } else {
            const visibilityInKm = metersToKm(visibilityValue); // Convert visibility from meters to Km's
            const visibilityFormatted = formatNumberWithCommas(visibilityInKm);
            visibilityElement.innerHTML = `<strong>Current Visibility:</strong> ${visibilityFormatted} km`;
        }

        // Update temperature
        const getFahrenheit = parseFloat('{{ Temp }}'.replace('F', '')); // Remove the 'F' and convert to number
        if (unitSystem === 'metric') {
            const tempInCelsius = fahrenheitToCelsius(getFahrenheit); // Convert temp from Fahrenheit to Celsius
            tempElement.innerHTML = `<strong>Current Temperature:</strong> ${tempInCelsius} C`;
        } else {
            tempElement.innerHTML = `<strong>Current Temperature:</strong> ${getFahrenheit} F`;
        }

        // Update base
        const baseValue = parseFloat('{{ Base }}');
        if (unitSystem === 'imperial') {
            const baseInFeet = metersToFeet(baseValue);
            const feet = Math.floor(baseInFeet); // Get the whole number of feet
            const inches = ((baseInFeet - feet) * 12).toFixed(0); // Convert the fractional part to inches
            baseElement.innerHTML = `<strong>Current Base:</strong> ${feet} ft ${inches} in`;
        } else {
            baseElement.innerHTML = `<strong>Current Base:</strong> ${baseValue} m`;
        }

        // Update precipitation
        const precipitationValue = parseFloat('{{ Precipitation }}');
        if (unitSystem === 'metric') {
            const precipitationInMillimeters = inchesToMillimeters(precipitationValue); // Convert precipitation from inches to millimeters
            precipitationElement.innerHTML = `<strong>Current Precipitation:</strong> ${precipitationInMillimeters} mm`;
        } else {
            precipitationElement.innerHTML = `<strong>Current Precipitation:</strong> ${precipitationValue} in`;
        }
        
	// Update temperature
        const getFahrenheit24 = parseFloat('{{ Temp24 }}'.replace('F', '')); // Remove the 'F' and convert to number
        if (unitSystem === 'metric') {
            const tempInCelsius24 = fahrenheitToCelsius(getFahrenheit24); // Convert temp from Fahrenheit to Celsius
            temp24Element.innerHTML = `<strong>Current Temperature:</strong> ${tempInCelsius24} C`;
        } else {
            temp24Element.innerHTML = `<strong>Current Temperature:</strong> ${getFahrenheit24} F`;
        }

        // Update precipitation
        const precipitationValue24 = parseFloat('{{ Precip24 }}');
        if (unitSystem === 'metric') {
            const precipitationInMillimeters24 = inchesToMillimeters(precipitationValue24); // Convert precipitation from inches to millimeters
            precip24Element.innerHTML = `<strong>Current Precipitation:</strong> ${precipitationInMillimeters24} mm`;
        } else {
            precip24Element.innerHTML = `<strong>Current Precipitation:</strong> ${precipitationValue24} in`;
        }
    }

    window.onload = function() {
        updateUnits(); // Set initial units based on the default value
    };
    </script>

</body>
    <div class="forecast-container">
        <h1>Next 24 Hours:</h1>
    <p id="temp24"><strong>Tomorrow's Temperature:</strong> {{ Temp24 }} F</p>
    <p id="precip24"><strong>Tomorrow's Precipitation:</strong> {{ Precip24 }} in</p>
    <script>

    </script>
    </div>
<body>

</body>
    <div class="forecast-container">
	<h1>Plan Your Trip</h1>
        <a href="{{resort_url}}" class="url-button">{{ resort_url }}</a>    
        <div class="back-link">
            <p>Back to <a href="/">Mountains</a></p>
        </div>
    </div>
<body>

</body>
</html>
